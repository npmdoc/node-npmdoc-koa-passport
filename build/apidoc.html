<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

        href="https://github.com/rkusa/koa-passport"

    >koa-passport (v3.0.0)</a>
</h1>
<h4>Passport middleware for Koa</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.koa-passport">module koa-passport</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.koa-passport.Authenticator">
            function <span class="apidocSignatureSpan">koa-passport.</span>Authenticator
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.koa-passport.KoaPassport">
            function <span class="apidocSignatureSpan">koa-passport.</span>KoaPassport
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.koa-passport.Passport">
            function <span class="apidocSignatureSpan">koa-passport.</span>Passport
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.koa-passport.Strategy">
            function <span class="apidocSignatureSpan">koa-passport.</span>Strategy
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.koa-passport.strategies.SessionStrategy">
            function <span class="apidocSignatureSpan">koa-passport.</span>strategies.SessionStrategy
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">koa-passport.</span>Authenticator.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">koa-passport.</span>Strategy.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">koa-passport.</span>_deserializers</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">koa-passport.</span>_framework</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">koa-passport.</span>_infoTransformers</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">koa-passport.</span>_serializers</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">koa-passport.</span>_strategies</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">koa-passport.</span>strategies</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">koa-passport.</span>strategies.SessionStrategy.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">koa-passport.</span>_key</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">koa-passport.</span>_userProperty</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.koa-passport.Authenticator">module koa-passport.Authenticator</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.koa-passport.Authenticator.Authenticator">
            function <span class="apidocSignatureSpan">koa-passport.</span>Authenticator
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.koa-passport.Authenticator.prototype">module koa-passport.Authenticator.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.koa-passport.Authenticator.prototype._strategy">
            function <span class="apidocSignatureSpan">koa-passport.Authenticator.prototype.</span>_strategy
            <span class="apidocSignatureSpan">(name)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.koa-passport.Authenticator.prototype.authenticate">
            function <span class="apidocSignatureSpan">koa-passport.Authenticator.prototype.</span>authenticate
            <span class="apidocSignatureSpan">(strategy, options, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.koa-passport.Authenticator.prototype.authorize">
            function <span class="apidocSignatureSpan">koa-passport.Authenticator.prototype.</span>authorize
            <span class="apidocSignatureSpan">(strategy, options, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.koa-passport.Authenticator.prototype.deserializeUser">
            function <span class="apidocSignatureSpan">koa-passport.Authenticator.prototype.</span>deserializeUser
            <span class="apidocSignatureSpan">(fn, req, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.koa-passport.Authenticator.prototype.framework">
            function <span class="apidocSignatureSpan">koa-passport.Authenticator.prototype.</span>framework
            <span class="apidocSignatureSpan">(fw)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.koa-passport.Authenticator.prototype.init">
            function <span class="apidocSignatureSpan">koa-passport.Authenticator.prototype.</span>init
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.koa-passport.Authenticator.prototype.initialize">
            function <span class="apidocSignatureSpan">koa-passport.Authenticator.prototype.</span>initialize
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.koa-passport.Authenticator.prototype.serializeUser">
            function <span class="apidocSignatureSpan">koa-passport.Authenticator.prototype.</span>serializeUser
            <span class="apidocSignatureSpan">(fn, req, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.koa-passport.Authenticator.prototype.session">
            function <span class="apidocSignatureSpan">koa-passport.Authenticator.prototype.</span>session
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.koa-passport.Authenticator.prototype.transformAuthInfo">
            function <span class="apidocSignatureSpan">koa-passport.Authenticator.prototype.</span>transformAuthInfo
            <span class="apidocSignatureSpan">(fn, req, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.koa-passport.Authenticator.prototype.unuse">
            function <span class="apidocSignatureSpan">koa-passport.Authenticator.prototype.</span>unuse
            <span class="apidocSignatureSpan">(name)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.koa-passport.Authenticator.prototype.use">
            function <span class="apidocSignatureSpan">koa-passport.Authenticator.prototype.</span>use
            <span class="apidocSignatureSpan">(name, strategy)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.koa-passport.Strategy">module koa-passport.Strategy</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.koa-passport.Strategy.Strategy">
            function <span class="apidocSignatureSpan">koa-passport.</span>Strategy
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.koa-passport.Strategy.prototype">module koa-passport.Strategy.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.koa-passport.Strategy.prototype.authenticate">
            function <span class="apidocSignatureSpan">koa-passport.Strategy.prototype.</span>authenticate
            <span class="apidocSignatureSpan">(req, options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.koa-passport._framework">module koa-passport._framework</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.koa-passport._framework.authenticate">
            function <span class="apidocSignatureSpan">koa-passport._framework.</span>authenticate
            <span class="apidocSignatureSpan">(passport, name, options, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.koa-passport._framework.authorize">
            function <span class="apidocSignatureSpan">koa-passport._framework.</span>authorize
            <span class="apidocSignatureSpan">(passport, name, options, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.koa-passport._framework.initialize">
            function <span class="apidocSignatureSpan">koa-passport._framework.</span>initialize
            <span class="apidocSignatureSpan">(passport)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.koa-passport.strategies">module koa-passport.strategies</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.koa-passport.strategies.SessionStrategy">
            function <span class="apidocSignatureSpan">koa-passport.strategies.</span>SessionStrategy
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.koa-passport.strategies.SessionStrategy">module koa-passport.strategies.SessionStrategy</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.koa-passport.strategies.SessionStrategy.SessionStrategy">
            function <span class="apidocSignatureSpan">koa-passport.strategies.</span>SessionStrategy
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.koa-passport.strategies.SessionStrategy.super_">
            function <span class="apidocSignatureSpan">koa-passport.strategies.SessionStrategy.</span>super_
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.koa-passport.strategies.SessionStrategy.prototype">module koa-passport.strategies.SessionStrategy.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.koa-passport.strategies.SessionStrategy.prototype.authenticate">
            function <span class="apidocSignatureSpan">koa-passport.strategies.SessionStrategy.prototype.</span>authenticate
            <span class="apidocSignatureSpan">(req, options)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.koa-passport" id="apidoc.module.koa-passport">module koa-passport</a></h1>


    <h2>
        <a href="#apidoc.element.koa-passport.Authenticator" id="apidoc.element.koa-passport.Authenticator">
        function <span class="apidocSignatureSpan">koa-passport.</span>Authenticator
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Authenticator() {
  this._key = &#x27;passport&#x27;;
  this._strategies = {};
  this._serializers = [];
  this._deserializers = [];
  this._infoTransformers = [];
  this._framework = null;
  this._userProperty = &#x27;user&#x27;;

  this.init();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.koa-passport.KoaPassport" id="apidoc.element.koa-passport.KoaPassport">
        function <span class="apidocSignatureSpan">koa-passport.</span>KoaPassport
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">class KoaPassport extends Passport {
  constructor() {
    super()
    this.framework(framework)
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.koa-passport.Passport" id="apidoc.element.koa-passport.Passport">
        function <span class="apidocSignatureSpan">koa-passport.</span>Passport
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Authenticator() {
  this._key = &#x27;passport&#x27;;
  this._strategies = {};
  this._serializers = [];
  this._deserializers = [];
  this._infoTransformers = [];
  this._framework = null;
  this._userProperty = &#x27;user&#x27;;

  this.init();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.koa-passport.Strategy" id="apidoc.element.koa-passport.Strategy">
        function <span class="apidocSignatureSpan">koa-passport.</span>Strategy
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Strategy() {
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.koa-passport.strategies.SessionStrategy" id="apidoc.element.koa-passport.strategies.SessionStrategy">
        function <span class="apidocSignatureSpan">koa-passport.</span>strategies.SessionStrategy
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function SessionStrategy() {
  Strategy.call(this);
  this.name = &#x27;session&#x27;;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>
























</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.koa-passport.Authenticator" id="apidoc.module.koa-passport.Authenticator">module koa-passport.Authenticator</a></h1>


    <h2>
        <a href="#apidoc.element.koa-passport.Authenticator.Authenticator" id="apidoc.element.koa-passport.Authenticator.Authenticator">
        function <span class="apidocSignatureSpan">koa-passport.</span>Authenticator
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Authenticator() {
  this._key = &#x27;passport&#x27;;
  this._strategies = {};
  this._serializers = [];
  this._deserializers = [];
  this._infoTransformers = [];
  this._framework = null;
  this._userProperty = &#x27;user&#x27;;

  this.init();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.koa-passport.Authenticator.prototype" id="apidoc.module.koa-passport.Authenticator.prototype">module koa-passport.Authenticator.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.koa-passport.Authenticator.prototype._strategy" id="apidoc.element.koa-passport.Authenticator.prototype._strategy">
        function <span class="apidocSignatureSpan">koa-passport.Authenticator.prototype.</span>_strategy
        <span class="apidocSignatureSpan">(name)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_strategy = function (name) {
  return this._strategies[name];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.koa-passport.Authenticator.prototype.authenticate" id="apidoc.element.koa-passport.Authenticator.prototype.authenticate">
        function <span class="apidocSignatureSpan">koa-passport.Authenticator.prototype.</span>authenticate
        <span class="apidocSignatureSpan">(strategy, options, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">authenticate = function (strategy, options, callback) {
  return this._framework.authenticate(this, strategy, options, callback);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
## 0.4.0

- Add support for custom authentication methods, e.g.:

```js
public.post(&#x27;/login&#x27;, function*(next) {
var ctx = this
yield* passport.<span class="apidocCodeKeywordSpan">authenticate</span>(&#x27;local&#x27;, function*(err, user, info) {
  if (err) throw err
  if (user === false) {
    ctx.status = 401
    ctx.body = { success: false }
  } else {
    yield ctx.login(user)
    ctx.body = { success: true }
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.koa-passport.Authenticator.prototype.authorize" id="apidoc.element.koa-passport.Authenticator.prototype.authorize">
        function <span class="apidocSignatureSpan">koa-passport.Authenticator.prototype.</span>authorize
        <span class="apidocSignatureSpan">(strategy, options, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">authorize = function (strategy, options, callback) {
  options = options || {};
  options.assignProperty = &#x27;account&#x27;;

  var fn = this._framework.authorize || this._framework.authenticate;
  return fn(this, strategy, options, callback);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.koa-passport.Authenticator.prototype.deserializeUser" id="apidoc.element.koa-passport.Authenticator.prototype.deserializeUser">
        function <span class="apidocSignatureSpan">koa-passport.Authenticator.prototype.</span>deserializeUser
        <span class="apidocSignatureSpan">(fn, req, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">deserializeUser = function (fn, req, done) {
  if (typeof fn === &#x27;function&#x27;) {
    return this._deserializers.push(fn);
  }

  // private implementation that traverses the chain of deserializers,
  // attempting to deserialize a user
  var obj = fn;

  // For backwards compatibility
  if (typeof req === &#x27;function&#x27;) {
    done = req;
    req = undefined;
  }

  var stack = this._deserializers;
  (function pass(i, err, user) {
    // deserializers use &#x27;pass&#x27; as an error to skip processing
    if (&#x27;pass&#x27; === err) {
      err = undefined;
    }
    // an error or deserialized user was obtained, done
    if (err || user) { return done(err, user); }
    // a valid user existed when establishing the session, but that user has
    // since been removed
    if (user === null || user === false) { return done(null, false); }

    var layer = stack[i];
    if (!layer) {
      return done(new Error(&#x27;Failed to deserialize user out of session&#x27;));
    }


    function deserialized(e, u) {
      pass(i + 1, e, u);
    }

    try {
      var arity = layer.length;
      if (arity == 3) {
        layer(req, obj, deserialized);
      } else {
        layer(obj, deserialized);
      }
    } catch(e) {
      return done(e);
    }
  })(0);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.koa-passport.Authenticator.prototype.framework" id="apidoc.element.koa-passport.Authenticator.prototype.framework">
        function <span class="apidocSignatureSpan">koa-passport.Authenticator.prototype.</span>framework
        <span class="apidocSignatureSpan">(fw)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">framework = function (fw) {
  this._framework = fw;
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
connect.__monkeypatchNode = function() {}

// load passport and add the koa framework
const passport = require(&#x27;passport&#x27;)
const Passport = require(&#x27;passport&#x27;).Passport
const framework = require(&#x27;./framework/koa&#x27;)()

passport.<span class="apidocCodeKeywordSpan">framework</span>(framework)

class KoaPassport extends Passport {
  constructor() {
    super()
    this.framework(framework)
  }
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.koa-passport.Authenticator.prototype.init" id="apidoc.element.koa-passport.Authenticator.prototype.init">
        function <span class="apidocSignatureSpan">koa-passport.Authenticator.prototype.</span>init
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">init = function () {
  this.framework(require(&#x27;./framework/connect&#x27;)());
  this.use(new SessionStrategy());
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.koa-passport.Authenticator.prototype.initialize" id="apidoc.element.koa-passport.Authenticator.prototype.initialize">
        function <span class="apidocSignatureSpan">koa-passport.Authenticator.prototype.</span>initialize
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">initialize = function (options) {
  options = options || {};
  this._userProperty = options.userProperty || &#x27;user&#x27;;

  return this._framework.initialize(this, options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
// Sessions
const convert = require(&#x27;koa-convert&#x27;) // necessary until koa-generic-session has been updated to support koa@2
const session = require(&#x27;koa-generic-session&#x27;)
app.keys = [&#x27;secret&#x27;]
app.use(convert(session()))

const passport = require(&#x27;koa-passport&#x27;)
app.use(passport.<span class="apidocCodeKeywordSpan">initialize</span>())
app.use(passport.session())
```

[Example Application](https://github.com/rkusa/koa-passport-example)

Passport&#x27;s values and methods are exposed as follows:
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.koa-passport.Authenticator.prototype.serializeUser" id="apidoc.element.koa-passport.Authenticator.prototype.serializeUser">
        function <span class="apidocSignatureSpan">koa-passport.Authenticator.prototype.</span>serializeUser
        <span class="apidocSignatureSpan">(fn, req, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">serializeUser = function (fn, req, done) {
  if (typeof fn === &#x27;function&#x27;) {
    return this._serializers.push(fn);
  }

  // private implementation that traverses the chain of serializers, attempting
  // to serialize a user
  var user = fn;

  // For backwards compatibility
  if (typeof req === &#x27;function&#x27;) {
    done = req;
    req = undefined;
  }

  var stack = this._serializers;
  (function pass(i, err, obj) {
    // serializers use &#x27;pass&#x27; as an error to skip processing
    if (&#x27;pass&#x27; === err) {
      err = undefined;
    }
    // an error or serialized object was obtained, done
    if (err || obj || obj === 0) { return done(err, obj); }

    var layer = stack[i];
    if (!layer) {
      return done(new Error(&#x27;Failed to serialize user into session&#x27;));
    }


    function serialized(e, o) {
      pass(i + 1, e, o);
    }

    try {
      var arity = layer.length;
      if (arity == 3) {
        layer(req, user, serialized);
      } else {
        layer(user, serialized);
      }
    } catch(e) {
      return done(e);
    }
  })(0);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.koa-passport.Authenticator.prototype.session" id="apidoc.element.koa-passport.Authenticator.prototype.session">
        function <span class="apidocSignatureSpan">koa-passport.Authenticator.prototype.</span>session
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">session = function (options) {
  return this.authenticate(&#x27;session&#x27;, options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
const convert = require(&#x27;koa-convert&#x27;) // necessary until koa-generic-session has been updated to support koa@2
const session = require(&#x27;koa-generic-session&#x27;)
app.keys = [&#x27;secret&#x27;]
app.use(convert(session()))

const passport = require(&#x27;koa-passport&#x27;)
app.use(passport.initialize())
app.use(passport.<span class="apidocCodeKeywordSpan">session</span>())
```

[Example Application](https://github.com/rkusa/koa-passport-example)

Passport&#x27;s values and methods are exposed as follows:

```js
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.koa-passport.Authenticator.prototype.transformAuthInfo" id="apidoc.element.koa-passport.Authenticator.prototype.transformAuthInfo">
        function <span class="apidocSignatureSpan">koa-passport.Authenticator.prototype.</span>transformAuthInfo
        <span class="apidocSignatureSpan">(fn, req, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">transformAuthInfo = function (fn, req, done) {
  if (typeof fn === &#x27;function&#x27;) {
    return this._infoTransformers.push(fn);
  }

  // private implementation that traverses the chain of transformers,
  // attempting to transform auth info
  var info = fn;

  // For backwards compatibility
  if (typeof req === &#x27;function&#x27;) {
    done = req;
    req = undefined;
  }

  var stack = this._infoTransformers;
  (function pass(i, err, tinfo) {
    // transformers use &#x27;pass&#x27; as an error to skip processing
    if (&#x27;pass&#x27; === err) {
      err = undefined;
    }
    // an error or transformed info was obtained, done
    if (err || tinfo) { return done(err, tinfo); }

    var layer = stack[i];
    if (!layer) {
      // if no transformers are registered (or they all pass), the default
      // behavior is to use the un-transformed info as-is
      return done(null, info);
    }


    function transformed(e, t) {
      pass(i + 1, e, t);
    }

    try {
      var arity = layer.length;
      if (arity == 1) {
        // sync
        var t = layer(info);
        transformed(null, t);
      } else if (arity == 3) {
        layer(req, info, transformed);
      } else {
        layer(info, transformed);
      }
    } catch(e) {
      return done(e);
    }
  })(0);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.koa-passport.Authenticator.prototype.unuse" id="apidoc.element.koa-passport.Authenticator.prototype.unuse">
        function <span class="apidocSignatureSpan">koa-passport.Authenticator.prototype.</span>unuse
        <span class="apidocSignatureSpan">(name)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">unuse = function (name) {
  delete this._strategies[name];
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.koa-passport.Authenticator.prototype.use" id="apidoc.element.koa-passport.Authenticator.prototype.use">
        function <span class="apidocSignatureSpan">koa-passport.Authenticator.prototype.</span>use
        <span class="apidocSignatureSpan">(name, strategy)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">use = function (name, strategy) {
  if (!strategy) {
    strategy = name;
    name = strategy.name;
  }
  if (!name) { throw new Error(&#x27;Authentication strategies must have a name&#x27;); }

  this._strategies[name] = strategy;
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
- update custom authentication callback arguments to `err, user, info, status` (e.g. `passport.authenticate(&#x27;local&#x27;, function
(err, user, info, status) { ... })(ctx, next)`)

## Usage

```js
// body parser
const bodyParser = require(&#x27;koa-bodyparser&#x27;)
app.<span class="apidocCodeKeywordSpan">use</span>(bodyParser())

// Sessions
const convert = require(&#x27;koa-convert&#x27;) // necessary until koa-generic-session has been updated to support koa@2
const session = require(&#x27;koa-generic-session&#x27;)
app.keys = [&#x27;secret&#x27;]
app.use(convert(session()))
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.koa-passport.Strategy" id="apidoc.module.koa-passport.Strategy">module koa-passport.Strategy</a></h1>


    <h2>
        <a href="#apidoc.element.koa-passport.Strategy.Strategy" id="apidoc.element.koa-passport.Strategy.Strategy">
        function <span class="apidocSignatureSpan">koa-passport.</span>Strategy
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Strategy() {
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.koa-passport.Strategy.prototype" id="apidoc.module.koa-passport.Strategy.prototype">module koa-passport.Strategy.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.koa-passport.Strategy.prototype.authenticate" id="apidoc.element.koa-passport.Strategy.prototype.authenticate">
        function <span class="apidocSignatureSpan">koa-passport.Strategy.prototype.</span>authenticate
        <span class="apidocSignatureSpan">(req, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">authenticate = function (req, options) {
  throw new Error(&#x27;Strategy#authenticate must be overridden by subclass&#x27;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
## 0.4.0

- Add support for custom authentication methods, e.g.:

```js
public.post(&#x27;/login&#x27;, function*(next) {
var ctx = this
yield* passport.<span class="apidocCodeKeywordSpan">authenticate</span>(&#x27;local&#x27;, function*(err, user, info) {
  if (err) throw err
  if (user === false) {
    ctx.status = 401
    ctx.body = { success: false }
  } else {
    yield ctx.login(user)
    ctx.body = { success: true }
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.koa-passport._framework" id="apidoc.module.koa-passport._framework">module koa-passport._framework</a></h1>


    <h2>
        <a href="#apidoc.element.koa-passport._framework.authenticate" id="apidoc.element.koa-passport._framework.authenticate">
        function <span class="apidocSignatureSpan">koa-passport._framework.</span>authenticate
        <span class="apidocSignatureSpan">(passport, name, options, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function authenticate(passport, name, options, callback) {
  // normalize arguments
  if (typeof options === &#x27;function&#x27;) {
    callback = options
    options  = {}
  }
  options = options || {}

  if (callback) {
    // When the callback is set, neither `next`, `res.redirect` or `res.end`
    // are called. That is, a workaround to catch the `callback` is required.
    // The `passportAuthenticate()` method below will therefore set
    // `callback.resolve` and `callback.reject`. Then, once the authentication
    // finishes, the modified callback calls the original one and afterwards
    // triggers either `callback.resolve` or `callback.reject` to inform
    // `passportAuthenticate()` that we are ready.
    const _callback = callback
    callback = function(err, user, info, status) {
      try {
        Promise.resolve(_callback(err, user, info, status))
               .then(() =&#x3e; callback.resolve(false))
               .catch(err =&#x3e; callback.reject(err))
      } catch (err) {
        callback.reject(err)
      }
    }
  }

  const middleware = promisify(_authenticate(passport, name, options, callback))

  return function passportAuthenticate(ctx, next) {
    // this functions wraps the connect middleware
    // to catch `next`, `res.redirect` and `res.end` calls
    const p = new Promise((resolve, reject) =&#x3e; {
      // mock the `req` object
      const req = createReqMock(ctx, options.assignProperty || passport._userProperty || &#x27;user&#x27;)

      // mock the `res` object
      const res = {
        redirect: function(url) {
          ctx.redirect(url)
          resolve(false)
        },
        setHeader: ctx.set.bind(ctx),
        end: function(content) {
          if (content) ctx.body = content
          resolve(false)
        },
        set statusCode(status) {
          ctx.status = status
        },
        get statusCode() {
          return ctx.status
        }
      }

      // update the custom callback above
      if (callback) {
        callback.resolve = resolve
        callback.reject  = reject
      }

      // call the connect middleware
      middleware(req, res).then(resolve, reject)
    })

    return p.then(cont =&#x3e; {
      // cont equals `false` when `res.redirect` or `res.end` got called
      // in this case, call next to continue through Koa&#x27;s middleware stack
      if (cont !== false) {
        return next()
      }
    })
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
## 0.4.0

- Add support for custom authentication methods, e.g.:

```js
public.post(&#x27;/login&#x27;, function*(next) {
var ctx = this
yield* passport.<span class="apidocCodeKeywordSpan">authenticate</span>(&#x27;local&#x27;, function*(err, user, info) {
  if (err) throw err
  if (user === false) {
    ctx.status = 401
    ctx.body = { success: false }
  } else {
    yield ctx.login(user)
    ctx.body = { success: true }
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.koa-passport._framework.authorize" id="apidoc.element.koa-passport._framework.authorize">
        function <span class="apidocSignatureSpan">koa-passport._framework.</span>authorize
        <span class="apidocSignatureSpan">(passport, name, options, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function authorize(passport, name, options, callback) {
  options = options || {}
  options.assignProperty = &#x27;account&#x27;

  return authenticate(passport, name, options, callback)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.koa-passport._framework.initialize" id="apidoc.element.koa-passport._framework.initialize">
        function <span class="apidocSignatureSpan">koa-passport._framework.</span>initialize
        <span class="apidocSignatureSpan">(passport)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function initialize(passport) {
  const middleware = promisify(_initialize(passport))
  return function passportInitialize(ctx, next) {
    // koa &#x3c;-&#x3e; connect compatibility:
    const userProperty = passport._userProperty || &#x27;user&#x27;
    // check ctx.req has the userProperty
    if (!ctx.req.hasOwnProperty(userProperty)) {
      Object.defineProperty(ctx.req, userProperty, {
        enumerable: true,
        get: function() {
          return ctx.state[userProperty]
        },
        set: function(val) {
          ctx.state[userProperty] = val
        }
      })
    }

    // create mock object for express&#x27; req object
    const req = createReqMock(ctx, userProperty)


    // add Promise-based login method
    const login  = req.login
    ctx.login = ctx.logIn = function(user, options) {
      return new Promise((resolve, reject) =&#x3e; {
        login.call(req, user, options, err =&#x3e; {
          if (err) reject(err)
          else resolve()
        })
      })
    }

    // add aliases for passport&#x27;s request extensions to Koa&#x27;s context
    ctx.logout = ctx.logOut = req.logout.bind(req)
    ctx.isAuthenticated     = req.isAuthenticated.bind(req)
    ctx.isUnauthenticated   = req.isUnauthenticated.bind(req)

    return middleware(req, ctx).then(function() {
      return next()
    })
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
// Sessions
const convert = require(&#x27;koa-convert&#x27;) // necessary until koa-generic-session has been updated to support koa@2
const session = require(&#x27;koa-generic-session&#x27;)
app.keys = [&#x27;secret&#x27;]
app.use(convert(session()))

const passport = require(&#x27;koa-passport&#x27;)
app.use(passport.<span class="apidocCodeKeywordSpan">initialize</span>())
app.use(passport.session())
```

[Example Application](https://github.com/rkusa/koa-passport-example)

Passport&#x27;s values and methods are exposed as follows:
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.koa-passport.strategies" id="apidoc.module.koa-passport.strategies">module koa-passport.strategies</a></h1>


    <h2>
        <a href="#apidoc.element.koa-passport.strategies.SessionStrategy" id="apidoc.element.koa-passport.strategies.SessionStrategy">
        function <span class="apidocSignatureSpan">koa-passport.strategies.</span>SessionStrategy
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function SessionStrategy() {
  Strategy.call(this);
  this.name = &#x27;session&#x27;;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.koa-passport.strategies.SessionStrategy" id="apidoc.module.koa-passport.strategies.SessionStrategy">module koa-passport.strategies.SessionStrategy</a></h1>


    <h2>
        <a href="#apidoc.element.koa-passport.strategies.SessionStrategy.SessionStrategy" id="apidoc.element.koa-passport.strategies.SessionStrategy.SessionStrategy">
        function <span class="apidocSignatureSpan">koa-passport.strategies.</span>SessionStrategy
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function SessionStrategy() {
  Strategy.call(this);
  this.name = &#x27;session&#x27;;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.koa-passport.strategies.SessionStrategy.super_" id="apidoc.element.koa-passport.strategies.SessionStrategy.super_">
        function <span class="apidocSignatureSpan">koa-passport.strategies.SessionStrategy.</span>super_
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Strategy() {
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.koa-passport.strategies.SessionStrategy.prototype" id="apidoc.module.koa-passport.strategies.SessionStrategy.prototype">module koa-passport.strategies.SessionStrategy.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.koa-passport.strategies.SessionStrategy.prototype.authenticate" id="apidoc.element.koa-passport.strategies.SessionStrategy.prototype.authenticate">
        function <span class="apidocSignatureSpan">koa-passport.strategies.SessionStrategy.prototype.</span>authenticate
        <span class="apidocSignatureSpan">(req, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">authenticate = function (req, options) {
  if (!req._passport) { return this.error(new Error(&#x27;passport.initialize() middleware not in use&#x27;)); }
  options = options || {};

  var self = this,
      su;
  if (req._passport.session) {
    su = req._passport.session.user;
  }

  if (su || su === 0) {
    // NOTE: Stream pausing is desirable in the case where later middleware is
    //       listening for events emitted from request.  For discussion on the
    //       matter, refer to: https://github.com/jaredhanson/passport/pull/106

    var paused = options.pauseStream ? pause(req) : null;
    req._passport.instance.deserializeUser(su, req, function(err, user) {
      if (err) { return self.error(err); }
      if (!user) {
        delete req._passport.session.user;
        self.pass();
        if (paused) {
          paused.resume();
        }
        return;
      }
      var property = req._passport.instance._userProperty || &#x27;user&#x27;;
      req[property] = user;
      self.pass();
      if (paused) {
        paused.resume();
      }
    });
  } else {
    self.pass();
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
## 0.4.0

- Add support for custom authentication methods, e.g.:

```js
public.post(&#x27;/login&#x27;, function*(next) {
var ctx = this
yield* passport.<span class="apidocCodeKeywordSpan">authenticate</span>(&#x27;local&#x27;, function*(err, user, info) {
  if (err) throw err
  if (user === false) {
    ctx.status = 401
    ctx.body = { success: false }
  } else {
    yield ctx.login(user)
    ctx.body = { success: true }
...</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
